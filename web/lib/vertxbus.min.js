var vertx=vertx||{};
!function(j){"function"===typeof define&&define.amd?define("vertxbus",["sockjs"],j):j(SockJS)}(function(j){vertx.EventBus=function(n,o){function m(b,a,c,d){e("address","string",a);e("message","object",c);e("replyHandler","function",d,!0);k();b={type:b,address:a,body:c};d&&(a=p(),b.replyAddress=a,l[a]=d);d=JSON.stringify(b);g.send(d)}function k(){if(h!=vertx.EventBus.OPEN)throw Error("INVALID_STATE_ERR");}function e(b,a,c,d){if(!d&&!c)throw Error("Parameter "+b+" must be specified");if(c&&typeof c!=
a)throw Error("Parameter "+b+" must be of type "+a);}function p(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b,a){return a=16*Math.random(),("y"==b?a&3|8:a|0).toString(16)})}var f=this,g=new j(n,o),i={},l={},h=vertx.EventBus.CONNECTING;f.onopen=null;f.onclose=null;f.send=function(b,a,c){m("send",b,a,c)};f.publish=function(b,a,c){m("publish",b,a,c)};f.registerHandler=function(b,a){e("address","string",b);e("handler","function",a);k();var c=i[b];c?c[c.length]=a:(c=[a],i[b]=
c,g.send(JSON.stringify({type:"register",address:b})))};f.unregisterHandler=function(b,a){e("address","string",b);e("handler","function",a);k();var c=i[b];if(c){var d=c.indexOf(a);-1!=d&&c.splice(d,1);0==c.length&&(g.send(JSON.stringify({type:"unregister",address:b})),delete i[b])}};f.close=function(){k();h=vertx.EventBus.CLOSING;g.close()};f.readyState=function(){return h};g.onopen=function(){h=vertx.EventBus.OPEN;if(f.onopen)f.onopen()};g.onclose=function(){h=vertx.EventBus.CLOSED;if(f.onclose)f.onclose()};
g.onmessage=function(b){var a=JSON.parse(b.data),b=a.body,c=a.replyAddress,a=a.address,d;c&&(d=function(a,b){f.send(c,a,b)});var e=i[a];if(e){a=e.slice(0);for(e=0;e<a.length;e++)a[e](b,d)}else if(a=l[a])delete l[c],a(b,d)}};vertx.EventBus.CONNECTING=0;vertx.EventBus.OPEN=1;vertx.EventBus.CLOSING=2;vertx.EventBus.CLOSED=3;return vertx.EventBus});